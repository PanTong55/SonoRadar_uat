import WaveSurfer from"./wavesurfer.esm.js";import Spectrogram from"./spectrogram.esm.js";import SpectrogramFlash from"./spectrogram-flash.esm.js";let ws=null,plugin=null,currentColorMap=null,currentFftSize=1024,currentWindowType="hann";export function initWavesurfer({container:e,url:r,sampleRate:n=256e3}){return ws=WaveSurfer.create({container:e,height:0,interact:!1,cursorWidth:0,url:r,sampleRate:n}),ws}export function createSpectrogramPlugin({colorMap:e,height:r=800,frequencyMin:n=10,frequencyMax:t=128,fftSamples:o=1024,noverlap:l=null,windowFunc:c="hann"}){const u={labels:!1,height:r,fftSamples:o,frequencyMin:1e3*n,frequencyMax:1e3*t,scale:"linear",windowFunc:c,colorMap:e};return null!==l&&(u.noverlap=l),Spectrogram.create(u)}export function createSpectrogramFlashPlugin({colorMap:e,height:r=800,frequencyMin:n=10,frequencyMax:t=128,fftSamples:o=1024,noverlap:l=null,windowFunc:c="hann"}){const u={labels:!1,height:r,fftSamples:o,frequencyMin:1e3*n,frequencyMax:1e3*t,scale:"linear",windowFunc:c,colorMap:e};return null!==l&&(u.noverlap=l),SpectrogramFlash.create(u)}export function replacePlugin(e,r=800,n=10,t=128,o=null,l=null,c=currentFftSize,u=currentWindowType,i=!1){if(!ws)throw new Error("Wavesurfer not initialized.");const a=document.getElementById("spectrogram-only"),s=a.querySelector("canvas");s&&s.remove(),plugin?.destroy&&(plugin.destroy(),plugin=null),a.style.width="100%",currentColorMap=e,currentFftSize=c,currentWindowType=u;const p=null!==o?Math.floor(c*(o/100)):null;i?(plugin=createSpectrogramFlashPlugin({colorMap:e,height:r,frequencyMin:n,frequencyMax:t,fftSamples:c,noverlap:p,windowFunc:u}),plugin.isFlashPlugin=!0):(plugin=createSpectrogramPlugin({colorMap:e,height:r,frequencyMin:n,frequencyMax:t,fftSamples:c,noverlap:p,windowFunc:u}),plugin.isFlashPlugin=!1),ws.registerPlugin(plugin);try{plugin.render();const e=document.getElementById("viewer-container");e&&(e.style.overflowX="auto"),requestAnimationFrame((()=>{"function"==typeof l&&l()}));try{initWsScrollSync({scrollTargetId:"time-axis-wrapper"})}catch(e){}}catch(e){console.warn("⚠️ Spectrogram render failed:",e)}}export function getWavesurfer(){return ws}export function getPlugin(){return plugin}export function getCurrentColorMap(){return currentColorMap}export function getCurrentFftSize(){return currentFftSize}export function getCurrentWindowType(){return currentWindowType}export function initScrollSync({scrollSourceId:e,scrollTargetId:r}){const n=document.getElementById(e),t=document.getElementById(r);n&&t?n.addEventListener("scroll",(()=>{t.scrollLeft=n.scrollLeft})):console.warn("[scrollSync] One or both elements not found.")}export function initWsScrollSync({scrollTargetId:e}){const r=document.getElementById(e);if(!r)return void console.warn("[wsScrollSync] target not found.");if(!ws)return void console.warn("[wsScrollSync] wavesurfer not initialized yet.");if(ws._timeAxisSyncCleanup){try{ws._timeAxisSyncCleanup()}catch(e){}ws._timeAxisSyncCleanup=null}const n=ws.on("scroll",((e,n,t)=>{"number"==typeof t&&(r.scrollLeft=t)}));ws._timeAxisSyncCleanup=n;try{"function"==typeof ws.getScroll&&(r.scrollLeft=ws.getScroll())}catch(e){}}