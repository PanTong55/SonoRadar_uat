let peakModeActive=!1,peakThreshold=.4,peakToolBarOpen=!1;export function initPeakControl(e={}){const{peakBtnId:t="peakBtn",onPeakModeToggled:o=(()=>{}),onThresholdChanged:a=(()=>{})}=e,n=document.getElementById(t),d=document.getElementById("peak-mode-tool-bar"),l=document.getElementById("peakModeSwitch"),r=document.getElementById("peakThresholdSlider"),c=document.getElementById("peakThresholdVal"),i=document.getElementById("tool-bar");if(!n)return console.warn(`[peakControl] Button with ID "${t}" not found`),{toggle:()=>{},isActive:()=>peakModeActive};if(n.addEventListener("click",(()=>{d&&(d.classList.toggle("open"),peakToolBarOpen=d.classList.contains("open"),updatePeakButtonUI())})),d){new MutationObserver((()=>{peakToolBarOpen=d.classList.contains("open"),updatePeakButtonUI()})).observe(d,{attributes:!0,attributeFilter:["class"]})}if(i){new MutationObserver((()=>{updatePeakButtonUI()})).observe(i,{attributes:!0,attributeFilter:["class"]})}return l&&l.addEventListener("change",(()=>{peakModeActive=l.checked,updatePeakButtonUI(),o(peakModeActive)})),r&&(r.addEventListener("input",(e=>{peakThreshold=parseFloat(e.target.value),c&&(c.textContent=Math.round(100*peakThreshold)+"%")})),r.addEventListener("change",(()=>{a(peakThreshold)}))),{toggle:togglePeakMode,isActive:()=>peakModeActive,getState:()=>({peakModeActive:peakModeActive,peakThreshold:peakThreshold}),getThreshold:()=>peakThreshold,setThreshold:e=>{peakThreshold=e,r&&(r.value=e),c&&(c.textContent=Math.round(100*e)+"%")}}}function togglePeakMode(){peakModeActive=!peakModeActive,updatePeakButtonUI();const e=document.getElementById("peakModeSwitch");e&&(e.checked=peakModeActive)}function updatePeakButtonUI(){const e=document.getElementById("peakBtn");e&&(e.classList.remove("active","toolbar-open"),peakModeActive?(e.classList.add("active"),e.title="Peak Tracking Mode (Active"):peakToolBarOpen?(e.classList.add("toolbar-open"),e.title="Peak Tracking Mode (Toolbar Open)"):e.title="Peak Tracking Mode")}export function isPeakModeActive(){return peakModeActive}export function setPeakModeActive(e){peakModeActive=e,updatePeakButtonUI();const t=document.getElementById("peakModeSwitch");t&&(t.checked=e)}export function getPeakThreshold(){return peakThreshold}export function setPeakThreshold(e){peakThreshold=e;const t=document.getElementById("peakThresholdSlider"),o=document.getElementById("peakThresholdVal");t&&(t.value=e),o&&(o.textContent=Math.round(100*e)+"%")}