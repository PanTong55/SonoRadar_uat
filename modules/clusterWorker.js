import{ClusterEngine}from"./markerClusterer.js";let clusterEngine=null,currentZoom=13,currentBounds=null;self.onmessage=async e=>{const{type:s,payload:t}=e.data;try{switch(s){case"INIT":clusterEngine=new ClusterEngine(t.points),self.postMessage({type:"INIT_DONE",success:!0});break;case"UPDATE_POINTS":clusterEngine&&clusterEngine.updatePoints(t.points),self.postMessage({type:"UPDATE_POINTS_DONE",success:!0});break;case"COMPUTE_CLUSTERS":{if(!clusterEngine){self.postMessage({type:"ERROR",message:"ClusterEngine not initialized"});break}currentZoom=t.zoom,currentBounds=t.bounds;const e=clusterEngine.computeClusters(t.zoom,t.bounds);self.postMessage({type:"CLUSTERS_COMPUTED",result:{clusters:e.clusters,visiblePoints:e.visiblePoints,isClustered:e.isClustered,allPointsInBounds:e.allPointsInBounds||[],timestamp:Date.now()}});break}default:self.postMessage({type:"ERROR",message:`Unknown message type: ${s}`})}}catch(e){self.postMessage({type:"ERROR",message:e.message,stack:e.stack})}},console.log("[ClusterWorker] Worker initialized and ready");